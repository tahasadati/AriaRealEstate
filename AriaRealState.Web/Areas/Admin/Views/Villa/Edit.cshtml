@model AriaRealState.Web.Areas.Admin.Models.Villa.EditVillaViewModel

<!-- Breadcrumb -->
<div class="mb-[25px] md:flex items-center justify-between">
	<h5 class="!mb-0">افزودن ویلا</h5>
</div>

<!-- Add Agent -->
<form method="post" asp-action="Create" asp-area="Admin" enctype="multipart/form-data">
	@Html.AntiForgeryToken()

	<div class="trezo-card bg-white dark:bg-[#0c1427] mb-[25px] p-[20px] md:p-[25px] rounded-md">
		<div class="trezo-card-content">

			<div asp-validation-summary="ModelOnly" class="text-danger-400 text-sm mb-[15px]"></div>

			<div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-[20px] md:gap-[25px]">

				<div>
					<label class="mb-[10px] text-black dark:text-white font-medium block">کد ویلا</label>
					<input type="text"
						   class="h-[55px] rounded-md text-black dark:text-white border border-gray-200 dark:border-[#172036] bg-white dark:bg-[#0c1427] px-[17px] block w-full outline-0 transition-all placeholder:text-gray-500 dark:placeholder:text-gray-400 focus:border-primary-500"
						   placeholder="کد ویلا" asp-for="Code" />
					<span asp-validation-for="Code" class="text-danger-400 text-sm mt-[10px] block"></span>
				</div>

				<div>
					<label class="mb-[10px] text-black dark:text-white font-medium block"> نام ویلا </label>
					<input type="text"
						   class="h-[55px] rounded-md text-black dark:text-white border border-gray-200 dark:border-[#172036] bg-white dark:bg-[#0c1427] px-[17px] block w-full outline-0 transition-all placeholder:text-gray-500 dark:placeholder:text-gray-400 focus:border-primary-500"
						   placeholder="نام ویلا" asp-for="Title" />
					<span asp-validation-for="Title" class="text-danger-400 text-sm mt-[10px] block"></span>
				</div>

				<div>
					<label class="mb-[10px] text-black dark:text-white font-medium block"> قیمت ویلا </label>
					<input type="number"
						   class="h-[55px] rounded-md text-black dark:text-white border border-gray-200 dark:border-[#172036] bg-white dark:bg-[#0c1427] px-[17px] block w-full outline-0 transition-all placeholder:text-gray-500 dark:placeholder:text-gray-400 focus:border-primary-500"
						   placeholder="قیمت" asp-for="ShowPrice" />
					<span asp-validation-for="ShowPrice" class="text-danger-400 text-sm mt-[10px] block"></span>
				</div>

				<div>
					<label class="mb-[10px] text-black dark:text-white font-medium block"> حداقل قیمت </label>
					<input type="text"
						   class="h-[55px] rounded-md text-black dark:text-white border border-gray-200 dark:border-[#172036] bg-white dark:bg-[#0c1427] px-[17px] block w-full outline-0 transition-all placeholder:text-gray-500 dark:placeholder:text-gray-400 focus:border-primary-500"
						   placeholder="حداقل قیمت" asp-for="MinPrice" />
					<span asp-validation-for="MinPrice" class="text-danger-400 text-sm mt-[10px] block"></span>
				</div>

				<div>
					<label class="mb-[10px] text-black dark:text-white font-medium block">تعداد اتاق خواب</label>
					<input type="number"
						   class="h-[55px] rounded-md text-black dark:text-white border border-gray-200 dark:border-[#172036] bg-white dark:bg-[#0c1427] px-[17px] block w-full outline-0 transition-all placeholder:text-gray-500 dark:placeholder:text-gray-400 focus:border-primary-500"
						   placeholder="تعداد اتاق خواب" asp-for="RoomCount" />
					<span asp-validation-for="RoomCount" class="text-danger-400 text-sm mt-[10px] block"></span>
				</div>

				<div>
					<label class="mb-[10px] text-black dark:text-white font-medium block"> وضعیت ویلا </label>
					<select
						class="h-[55px] rounded-md border border-gray-200 dark:border-[#172036] bg-white dark:bg-[#0c1427] px-[13px] block w-full outline-0 cursor-pointer transition-all focus:border-primary-500"
						asp-for="OccupancyStatus"
						asp-items="Html.GetEnumSelectList<AriaRealState.Data.Enums.Villa.VillaOccupancyStatus>()">
						<option value="">انتخاب کنید</option>
					</select>
					<span asp-validation-for="OccupancyStatus" class="text-danger-400 text-sm mt-[10px] block"></span>
				</div>

				<div>
					<label class="mb-[10px] text-black dark:text-white font-medium block"> نوع ویلا </label>
					<select
						class="h-[55px] rounded-md border border-gray-200 dark:border-[#172036] bg-white dark:bg-[#0c1427] px-[13px] block w-full outline-0 cursor-pointer transition-all focus:border-primary-500"
						asp-for="ArchitectureType"
						asp-items="Html.GetEnumSelectList<AriaRealState.Data.Enums.Villa.VillaArchitectureType>()">
						<option value="">انتخاب کنید</option>
					</select>
					<span asp-validation-for="ArchitectureType" class="text-danger-400 text-sm mt-[10px] block"></span>
				</div>

				<div>
					<label class="mb-[10px] text-black dark:text-white font-medium block"> نوع موقعیت </label>
					<select
						class="h-[55px] rounded-md border border-gray-200 dark:border-[#172036] bg-white dark:bg-[#0c1427] px-[13px] block w-full outline-0 cursor-pointer transition-all focus:border-primary-500"
						asp-for="LocationType"
						asp-items="Html.GetEnumSelectList<AriaRealState.Data.Enums.PropertyLocationType>()">
						<option value="">انتخاب کنید</option>
					</select>
					<span asp-validation-for="LocationType" class="text-danger-400 text-sm mt-[10px] block"></span>
				</div>

				<div>
					<label class="mb-[10px] text-black dark:text-white font-medium block"> نمایش در سایت </label>
					<select
						class="h-[55px] rounded-md border border-gray-200 dark:border-[#172036] bg-white dark:bg-[#0c1427] px-[13px] block w-full outline-0 cursor-pointer transition-all focus:border-primary-500"
						asp-for="IsShow">
						<option value="true">نمایش داده شود</option>
						<option value="false">نمایش داده نشود</option>
					</select>
					<span asp-validation-for="IsShow" class="text-danger-400 text-sm mt-[10px] block"></span>
				</div>

				<div>
					<label class="mb-[10px] text-black dark:text-white font-medium block"> متراژ زیر بنا </label>
					<input type="text"
						   class="h-[55px] rounded-md text-black dark:text-white border border-gray-200 dark:border-[#172036] bg-white dark:bg-[#0c1427] px-[17px] block w-full outline-0 transition-all placeholder:text-gray-500 dark:placeholder:text-gray-400 focus:border-primary-500"
						   placeholder="۱۸۰۰ فوت مربع" asp-for="InfrastructureSize" />
					<span asp-validation-for="InfrastructureSize"
						  class="text-danger-400 text-sm mt-[10px] block"></span>
				</div>

				<div>
					<label class="mb-[10px] text-black dark:text-white font-medium block"> متراژ زمین </label>
					<input type="text"
						   class="h-[55px] rounded-md text-black dark:text-white border border-gray-200 dark:border-[#172036] bg-white dark:bg-[#0c1427] px-[17px] block w-full outline-0 transition-all placeholder:text-gray-500 dark:placeholder:text-gray-400 focus:border-primary-500"
						   placeholder="متراژ زمین" asp-for="LandSize" />
					<span asp-validation-for="LandSize" class="text-danger-400 text-sm mt-[10px] block"></span>
				</div>

				<div>
					<label class="mb-[10px] text-black dark:text-white font-medium block"> چند سال ساخت </label>
					<input type="text"
						   class="h-[55px] rounded-md text-black dark:text-white border border-gray-200 dark:border-[#172036] bg-white dark:bg-[#0c1427] px-[17px] block w-full outline-0 transition-all placeholder:text-gray-500 dark:placeholder:text-gray-400 focus:border-primary-500"
						   placeholder="مثلا 5 سال ساخت" asp-for="BuildingYear" />
					<span asp-validation-for="BuildingYear" class="text-danger-400 text-sm mt-[10px] block"></span>
				</div>

				<div class="sm:col-span-3">
					<label class="mb-[10px] text-black dark:text-white font-medium block"> توضیحات </label>

					<!-- Visible rich text editor -->
					<div id="richTextEditor" class="!h-[179px]"></div>

					<!-- Actual bound field -->
					<textarea asp-for="Description" id="Description" class="hidden"></textarea>
					<span asp-validation-for="Description" class="text-danger-400 text-sm mt-[10px] block"></span>
				</div>

				<div class="grid sm:grid-cols-3 sm:col-span-3 sm:gap-[20px]">

					<div>
						<label class="mb-[10px] block">آپلود ویدئو</label>

						@if (!string.IsNullOrWhiteSpace(Model.ExistingVideoPath))
						{
							<div class="mb-3 rounded border p-2">
								<video controls class="w-full rounded">
									<source src="@Model.ExistingVideoPath" type="video/mp4" />
								</video>

								<label class="mt-2 flex items-center gap-2 text-sm">
									<input type="checkbox" asp-for="RemoveVideo" />
									حذف ویدئوی فعلی
								</label>

								<p class="text-xs mt-1 text-gray-500">
									اگر ویدئو جدید آپلود نکنی و گزینه حذف را نزنی، همین ویدئو حفظ می‌شود.
								</p>
							</div>
						}

						<div
							class="relative flex items-center justify-center overflow-hidden rounded-md py-[40px] px-[20px] border">
							<input type="file" class="absolute inset-0 opacity-0 cursor-pointer" asp-for="VideoFile"
								   accept="video/*" />
							<div class="text-sm">برای جایگزینی ویدئو کلیک کنید</div>
						</div>

						<span asp-validation-for="VideoFile" class="text-danger-400 text-sm mt-2 block"></span>
					</div>

					<div>
						<label class="mb-[10px] block">عکس اصلی (کاور)</label>

						@if (!string.IsNullOrWhiteSpace(Model.ExistingCoverPath))
						{
							<div class="mb-3 rounded border p-2">
								<img src="@Model.ExistingCoverPath" class="w-full h-40 object-cover rounded" />

								<label class="mt-2 flex items-center gap-2 text-sm">
									<input type="checkbox" asp-for="RemoveCover" />
									حذف کاور فعلی
								</label>

								<p class="text-xs mt-1 text-gray-500">
									اگر تصویر جدید ندهی و حذف را نزنی، کاور فعلی حفظ می‌شود.
								</p>
							</div>
						}

						<div
							class="relative flex items-center justify-center overflow-hidden rounded-md py-[40px] px-[20px] border">
							<input type="file" class="absolute inset-0 opacity-0 cursor-pointer"
								   asp-for="CoverImageFile" accept="image/*" />
							<div class="text-sm">برای جایگزینی کاور کلیک کنید</div>
						</div>

						<span asp-validation-for="CoverImageFile" class="text-danger-400 text-sm mt-2 block"></span>
					</div>

					<div>
						<label class="mb-[10px] block">عکس‌های گالری</label>

						@if (Model.ExistingGalleries?.Any() == true)
						{
							<div class="mb-3 rounded border p-2">
								<div class="grid grid-cols-3 gap-2">
									@foreach (var g in Model.ExistingGalleries)
									{
										<div class="border rounded p-1">
											<img src="@g.FilePath" class="w-full h-20 object-cover rounded" />
											<label class="mt-1 flex items-center gap-2 text-xs">
												<input type="checkbox" name="RemoveGalleryIds" value="@g.Id" />
												حذف
											</label>
										</div>
									}
								</div>

								<p class="text-xs mt-2 text-gray-500">
									هر عکسی را تیک بزنی بعد از ذخیره حذف می‌شود.
								</p>
							</div>
						}

						<div
							class="relative flex items-center justify-center overflow-hidden rounded-md py-[40px] px-[20px] border">
							<input type="file" class="absolute inset-0 opacity-0 cursor-pointer" name="GalleriesFile"
								   multiple accept="image/*" />
							<div class="text-sm">برای افزودن عکس‌های جدید کلیک کنید</div>
						</div>

						<ul id="fileList" class="mt-2 text-sm"></ul>
					</div>
				</div>

			</div>

			<div class="mt-[20px] md:mt-[25px]">
				<button type="button"
						class="font-medium inline-block transition-all rounded-md md:text-md ltr:mr-[15px] rtl:ml-[15px] py-[10px] md:py-[12px] px-[20px] md:px-[22px] bg-danger-500 text-white hover:bg-danger-400"
						onclick="history.back()">
					لغو
				</button>

				<button type="submit"
						class="font-medium inline-block transition-all rounded-md md:text-md py-[10px] md:py-[12px] px-[20px] md:px-[22px] bg-primary-500 text-white hover:bg-primary-400">
					<span class="inline-block relative ltr:pl-[29px] rtl:pr-[29px]">
						<i class="material-symbols-outlined ltr:left-0 rtl:right-0 absolute top-1/2 -translate-y-1/2">
							add
						</i>
						ایجاد ویلا
					</span>
				</button>
			</div>

		</div>
	</div>
</form>

@section Scripts {
	<partial name="_ValidationScriptsPartial" />

	<script>
						// If you are using a rich text editor (Quill/TinyMCE/etc),
						// make sure Description is synced before submit.
						(function () {
						  const form = document.querySelector('form');
						  const desc = document.getElementById('Description');
						  const editor = document.getElementById('richTextEditor');

						  if (!form || !desc || !editor) return;

						  // Try to load initial value into editor (simple fallback)
						  if (desc.value && !editor.innerHTML.trim()) {
							editor.innerHTML = desc.value;
						  }

						  form.addEventListener('submit', function () {
							// Basic sync: store HTML
							desc.value = editor.innerHTML;
						  });

						  // Optional: show selected gallery files in the list (keeps your existing UI)
						  const fileInput = document.getElementById('fileInput');
						  const fileList = document.getElementById('fileList');
						  if (fileInput && fileList) {
							fileInput.addEventListener('change', function () {
							  fileList.innerHTML = '';
							  for (const f of fileInput.files) {
								const li = document.createElement('li');
								li.className = "text-sm mt-[10px]";
								li.textContent = f.name;
								fileList.appendChild(li);
							  }
							});
						  }
						})();
	</script>
    <script>
        (function () {
            // نمایش نام فایل‌های جدید گالری
            const fileInput = document.querySelector('input[name="GalleriesFile"]');
            const fileList = document.getElementById('fileList');
            if (fileInput && fileList) {
                fileInput.addEventListener('change', function () {
                    fileList.innerHTML = '';
                    for (const f of fileInput.files) {
                        const li = document.createElement('li');
                        li.textContent = f.name;
                        fileList.appendChild(li);
                    }
                });
            }
        })();
    </script>
}